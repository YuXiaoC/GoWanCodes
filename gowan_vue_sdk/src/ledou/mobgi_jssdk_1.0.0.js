!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("mobgi",[],t);else{var o=t();for(var n in o)("object"==typeof exports?exports:e)[n]=o[n]}}(window,function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);var n=function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function i(e,t,o,n){return new(o||(o=Promise))(function(i,a){function r(e){try{d(n.next(e))}catch(e){a(e)}}function s(e){try{d(n.throw(e))}catch(e){a(e)}}function d(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(r,s)}d((n=n.apply(e,t||[])).next())})}function a(e,t){var o,n,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],n=0}finally{o=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function r(e){var t={method:"GET",url:"",data:"",timeout:6e4,dataType:"json",async:!0,cache:!0,withCredentials:!1,contentType:"application/x-www-form-urlencoded",headers:{},success:function(){},error:function(){}};for(var o in e)t[o]=e[o];return t.method=t.method.toUpperCase(),new Promise(function(e,o){var n,i=window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):Error("Not support XMLHttpRequest!");for(var a in t.withCredentials&&"withCredentials"in i&&(i.withCredentials=!0),t.headers)t.headers.hasOwnProperty(a)&&null!==t.headers[a]&&i.setRequestHeader(a,t.headers[a]);"GET"===t.method&&(t.data||t.cache)&&(t.url+="?"+function(e,t){void 0===t&&(t=!0);var o=[];for(var n in e){var i=n+"="+e[n];o.push(i)}if(t){var a=(+new Date).toString();o.push("rnd="+a)}return o.join("&")}(t.data,t.cache)),"POST"===t.method&&(n=t.data,"[object Object]"===Object.prototype.toString.call(n))&&("application/x-www-form-urlencoded"===t.contentType?t.data=function e(t){var o,n,i,a,r,s,d="";for(o in t)if((n=t[o])instanceof Array)for(s=0;s<n.length;++s)a=n[s],(r={})[o+"["+s+"]"]=a,d+=e(r)+"&";else if(n instanceof Object)for(i in n)a=n[i],(r={})[o+"["+i+"]"]=a,d+=e(r)+"&";else null!=n&&(d+=encodeURIComponent(o)+"="+encodeURIComponent(n)+"&");return d.length?d.substr(0,d.length-1):d}(t.data):t.data=JSON.stringify(t.data)),i.timeout=t.timeout,i.responseType=t.dataType,i.open(t.method,t.url,t.async),i.onloadend=function(){i.status>=200&&i.status<300||304===i.status?e(i.response):o({errorType:"status_error",xhr:i})},i.onabort=function(){o({errorType:"abort_error",xhr:i})},i.ontimeout=function(){o({errorType:"timeout_error",xhr:i})},i.onerror=function(){o({errorType:"onerror",xhr:i})},i.send("GET"===t.method?null:t.data)})}var s=function(e,t,o){return void 0===o&&(o={}),r(n({method:"POST",url:e,data:t},o))},d=function(){function e(){this.localStorage=window.localStorage}return e.prototype.get=function(e){if(this.localStorage){var t=+new Date,o=this.localStorage.getItem(e);if(o){var n=o.split("!@#$%");return+n[0]<t?(this.localStorage.removeItem(e),null):JSON.parse(n[1])}return null}},e.prototype.set=function(e,t,o){if(void 0===o&&(o={expires:2534022144e5}),this.localStorage){var n=o.expires+"!@#$%"+JSON.stringify(t);return this.localStorage.setItem(e,n)}},e}();function c(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(o){var n,i,a,r,s,d,c,l="",p=0;for(o=t(o);p<o.length;)r=(n=o.charCodeAt(p++))>>2,s=(3&n)<<4|(i=o.charCodeAt(p++))>>4,d=(15&i)<<2|(a=o.charCodeAt(p++))>>6,c=63&a,isNaN(i)?d=c=64:isNaN(a)&&(c=64),l=l+e.charAt(r)+e.charAt(s)+e.charAt(d)+e.charAt(c);return l},this.decode=function(t){var n,i,a,r,s,d,c="",l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)n=e.indexOf(t.charAt(l++))<<2|(r=e.indexOf(t.charAt(l++)))>>4,i=(15&r)<<4|(s=e.indexOf(t.charAt(l++)))>>2,a=(3&s)<<6|(d=e.indexOf(t.charAt(l++))),c+=String.fromCharCode(n),64!=s&&(c+=String.fromCharCode(i)),64!=d&&(c+=String.fromCharCode(a));return c=o(c)};var t=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var n=e.charCodeAt(o);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},o=function(e){for(var t="",o=0,n=0,i=0,a=0;o<e.length;)(n=e.charCodeAt(o))<128?(t+=String.fromCharCode(n),o++):n>191&&n<224?(i=e.charCodeAt(o+1),t+=String.fromCharCode((31&n)<<6|63&i),o+=2):(i=e.charCodeAt(o+1),a=e.charCodeAt(o+2),t+=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a),o+=3);return t}}function l(){var e=0,t=8;function o(e,t){var o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}function n(e,t){return e<<t|e>>>32-t}function i(e,t,o,n){return e<20?t&o|~t&n:e<40?t^o^n:e<60?t&o|t&n|o&n:t^o^n}function a(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}this.hex_sha1=function(r){return function(t){for(var o=e?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<4*t.length;i++)n+=o.charAt(t[i>>2]>>8*(3-i%4)+4&15)+o.charAt(t[i>>2]>>8*(3-i%4)&15);return n}(function(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var r=Array(80),s=1732584193,d=-271733879,c=-1732584194,l=271733878,p=-1009589776,h=0;h<e.length;h+=16){for(var u=s,f=d,m=c,y=l,g=p,_=0;_<80;_++){r[_]=_<16?e[h+_]:n(r[_-3]^r[_-8]^r[_-14]^r[_-16],1);var v=o(o(n(s,5),i(_,d,c,l)),o(o(p,r[_]),a(_)));p=l,l=c,c=n(d,30),d=s,s=v}s=o(s,u),d=o(d,f),c=o(c,m),l=o(l,y),p=o(p,g)}return Array(s,d,c,l,p)}(function(e){for(var o=Array(),n=(1<<t)-1,i=0;i<e.length*t;i+=t)o[i>>5]|=(e.charCodeAt(i/t)&n)<<24-i%32;return o}(r),r.length*t))}}var p=new c,h=new l;function u(){var e=+new Date/1e3,t=h.hex_sha1("1"+e);return p.encode("1,"+e+","+t)}function f(e,t){for(var o,n=0,i=[],a=0;a<e.length;a++){o=e[a][t]?100*e[a][t]:0;for(var r=0;r<o;r++)i.push(a);n+=o}return e[i[Math.floor(Math.random()*n)]]}var m="//api.mobgi.com",y={intergration:m+"/adx/v2/Intergration",report:m+"/adx/v1/web"};var g,_=1,v=2,k=3,b={OTHER:0,WIFI:1,"2G":2,"3G":3,"4G":4},C={LANDSCAPE:1,PORTRAIT:2};new c,new l;function I(e,t,o,n){if(void 0===n&&(n={onload:"",sign:"",appid:"",android_id:"",imei:""}),"js"===t){var i=document.createElement("script"),a=i.readyState;i.type="text/javascript",i.src=e,""!=n.onload&&i.setAttribute("onload",n.onload),""!=n.sign&&i.setAttribute("sign",n.sign),""!=n.appid&&i.setAttribute("appid",n.appid),""!=n.android_id&&i.setAttribute("android_id",n.android_id),""!=n.imei&&i.setAttribute("imei",n.imei),a?i.onreadystatechange=function(){"loaded"!==a&&"complete"!==a||(onreadystatechange=null,"function"==typeof o&&o())}:i.onload=function(){"function"==typeof o&&o(this)},document.body.appendChild(i)}else if("css"===t){var r=document.createElement("link"),s=r.readyState;r.type="text/css",r.rel="stylesheet",r.href=e,s?r.onreadystatechange=function(){"loaded"!==s&&"complete"!==s||(onreadystatechange=null,"function"==typeof o&&o())}:r.onload=function(){"function"==typeof o&&o()},document.getElementsByTagName("head")[0].appendChild(r)}}var A,w,E,T=function(){function e(e){g=this,this.name=e.name,this.container_id=e.containerId,this.sdk=e.sdk,this.ad_tag_url="https://googleads.g.doubleclick.net/pagead/ads?ad_type=video_image&hl=zh_CN&max_ad_duration=15000&client="+e.appKey+"&channel="+e.channel,this.is_ad_cached=!1,this.ads_manager_loaded=!1,this.ad_container=null,this.ad_display_container=null,this.ads_manager=null,this.ads_loader=null}return e.prototype.init=function(){var e=this;this.is_ad_cached=!1,this.sdk.sendReport(3,{adsId:this.name}),this.ads_loader?this.request_ads():I("https://imasdk.googleapis.com/js/sdkloader/ima3.js","js",function(){e.ad_container=document.getElementById(e.container_id);var t=document.createElement("DIV");t.id="adsenseContainer",t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.display="block",e.ad_container.appendChild(t);var o=window.google;e.ad_display_container=new o.ima.AdDisplayContainer(t),e.ads_loader=new o.ima.AdsLoader(e.ad_display_container),e.ads_loader.getSettings().setVpaidMode(o.ima.ImaSdkSettings.VpaidMode.ENABLED),e.ads_loader.getSettings().setPlayerVersion("1.00"),e.ads_loader.getSettings().setPlayerType("HTML5_Preloader"),e.ads_loader.addEventListener(o.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,e.on_ads_manager_loaded,!1),e.ads_loader.addEventListener(o.ima.AdErrorEvent.Type.AD_ERROR,e.onError,!1),e.request_ads()})},e.prototype.on_ads_manager_loaded=function(e){g.sdk.sendReport(4,{adsId:g.name}),console.log("ads manager loaded"),g.ads_manager_loaded=!0,g.isSkipped=!1;var t=window.google,o=new t.ima.AdsRenderingSettings;o.restoreCustomPlaybackStateOnAdBreakComplete=!0,g.ads_manager=e.getAdsManager(g.ad_display_container,o),g.ads_manager.addEventListener(t.ima.AdErrorEvent.Type.AD_ERROR,g.onError),g.ads_manager.addEventListener(t.ima.AdEvent.Type.LOADED,g.onCommonEvent),g.ads_manager.addEventListener(t.ima.AdEvent.Type.IMPRESSION,g.onCommonEvent),g.ads_manager.addEventListener(t.ima.AdEvent.Type.COMPLETE,g.onCommonEvent),g.ads_manager.addEventListener(t.ima.AdEvent.Type.USER_CLOSE,g.onCommonEvent),g.ads_manager.addEventListener(t.ima.AdEvent.Type.SKIPPED,g.onCommonEvent),g.ads_manager.addEventListener(t.ima.AdEvent.Type.CLICK,g.onCommonEvent),g.ads_manager.addEventListener(t.ima.AdEvent.Type.RESUMED,g.onCommonEvent)},e.prototype.onError=function(e){var t=g.sdk.events.error;t&&t({code:k,msg:"预加载广告时出错"}),console.log(e.getError())},e.prototype.onCommonEvent=function(e){console.log("广告事件",e);var t=window.google;switch(e.type){case t.ima.AdEvent.Type.LOADED:break;case t.ima.AdEvent.Type.IMPRESSION:g.ad_container.style.zIndex=99999,g.ad_container.style.opacity=1;g.sdk.sendReport(5,{adsId:g.name,eventValue:JSON.stringify({Adsense:!0})}),g.on_impression_callback&&g.on_impression_callback();break;case t.ima.AdEvent.Type.COMPLETE:g.sdk.sendReport(8,{adsId:g.name}),g.on_complete_callback&&g.on_complete_callback();break;case t.ima.AdEvent.Type.USER_CLOSE:g.sdk.sendReport(7,{adsId:g.name}),g.on_close_callback&&g.on_close_callback(),setTimeout(function(){g.isSkipped||(g.sdk.sendReport(8,{adsId:g.name}),g.on_complete_callback&&g.on_complete_callback()),g.sdk.preLoad(!1)},1e3);break;case t.ima.AdEvent.Type.SKIPPED:g.isSkipped=!0,g.sdk.sendReport(16,{adsId:g.name}),g.on_skip_callback&&g.on_skip_callback();break;case t.ima.AdEvent.Type.CLICK:g.sdk.sendReport(6,{adsId:g.name}),g.on_click_callback&&g.on_click_callback();break;case t.ima.AdEvent.Type.RESUMED:g.sdk.sendReport(9,{adsId:g.name}),g.on_click_callback&&g.on_click_callback()}[t.ima.AdEvent.Type.COMPLETE,t.ima.AdEvent.Type.USER_CLOSE,t.ima.AdEvent.Type.SKIPPED].indexOf(e.type)>-1&&(g.ad_container.style.zIndex=-999999,g.ad_container.style.opacity=0)},e.prototype.request_ads=function(){var e=new window.google.ima.AdsRequest;e.adTagUrl=this.ad_tag_url+"&correlator="+ +new Date,e.linearAdSlotWidth=this.ad_container.clientWidth,e.linearAdSlotHeight=this.ad_container.clientHeight,e.nonLinearAdSlotWidth=this.ad_container.clientWidth,e.nonLinearAdSlotHeight=this.ad_container.clientHeight,e.forceNonLinearFullSlot=!0,e.vastLoadTimeout=1e4,this.ads_loader.requestAds(e),this.is_ad_cached=!0},e.prototype.isReady=function(){return this.is_ad_cached&&this.ads_manager_loaded},e.prototype.showAdv=function(){if(!this.isReady)return!1;this.ad_display_container.initialize(),this.is_ad_cached=!1;try{this.ads_manager.init(this.ad_container.clientWidth,this.ad_container.clientHeight,window.google.ima.ViewMode.NORMAL),this.ads_manager.start()}catch(e){console.log("Play Ads Error:"+e)}},e.prototype.stop=function(){this.ad_container.style.zIndex=-999999,this.ad_container.style.opacity=0,this.sdk.sendReport(7,{adsId:this.name}),this.sdk.sendReport(16,{adsId:this.name}),this.on_close_callback&&this.on_close_callback(),this.on_skip_callback&&this.on_skip_callback(),this.ads_manager&&this.ads_manager.stop()},e.prototype.onLoaded=function(e){this.on_loaded_callback=e},e.prototype.onImpression=function(e){this.on_impression_callback=e},e.prototype.onComplete=function(e){this.on_complete_callback=e},e.prototype.onClose=function(e){this.on_close_callback=e},e.prototype.onSkip=function(e){this.on_skip_callback=e},e.prototype.onClick=function(e){this.on_click_callback=e},e}(),S=function(){function e(e){A=this,this.name=e.name,this.container_id=e.containerId,this.appKey=e.appKey,this.sdk=e.sdk,this.sign=e.sign,this.unitId=e.unitId,this.androidId=e.androidId,this.imei=e.imei,this.closeButtonPosition=e.closeButtonPosition,this.is_ad_cached=!1,this.is_play_finish=!1,this.ads_manager_loaded=!1,this.ad_container=null,this.ad_display_container=null,this.ads_manager=null,this.ads_loader=null}return e.prototype.init=function(){var e=this;(this.is_ad_cached=!1,this.sdk.sendReport(3,{adsId:this.name}),this.ads_loader)?this.request_ads():I("//vijs.rayjump.com/bin/vijs.js","js",function(t){window.Vijs.init(t),e.ads_loader=window.Vijs,e.ads_loader?e.request_ads():console.log("预加载失败，无法加载js")},{onload:"",sign:this.sign,appid:this.appKey,android_id:this.androidId,imei:this.imei})},e.prototype.onError=function(e){var t=A.sdk.events.error;t&&t({code:k,msg:"预加载广告时出错"}),console.log(e.getError())},e.prototype.request_ads=function(){A.ads_manager=A.ads_loader.setAD({unitid:A.unitId,autoplay:!0,android_id:A.androidId,imei:A.imei,endcardclosebuttonposition:this.closeButtonPosition,loadedCallback:function(){A.is_ad_cached=!0,console.log("ads mintegral loaded"),A.sdk.readyState=!0,A.sdk.sendReport(4,{adsId:A.name}),A.on_loaded_callback&&A.on_loaded_callback()},closeCallback:function(){A.sdk.sendReport(7,{adsId:A.name}),A.on_close_callback&&A.on_close_callback(),A.sdk.preLoad(!1),A.is_play_finish||(A.sdk.sendReport(16,{adsId:A.name}),A.on_skip_callback&&A.on_skip_callback())},videoEndedCallback:function(){A.is_play_finish=!0,A.sdk.sendReport(8,{adsId:A.name}),A.on_complete_callback&&A.on_complete_callback()},customOpen:function(){A.sdk.sendReport(6,{adsId:A.name}),A.on_click_callback&&A.on_click_callback()},errorCallback:function(e){var t=A.sdk.events.error;t&&t({code:k,msg:e})}}),A.ads_manager&&(A.ads_manager_loaded=!0)},e.prototype.isReady=function(){return this.is_ad_cached&&this.ads_manager_loaded},e.prototype.showAdv=function(){if(!this.isReady)return!1;this.is_ad_cached=!1,this.is_play_finish=!1;try{if(this.ads_manager.show()){this.sdk.sendReport(5,{adsId:this.name,eventValue:JSON.stringify({Mobvista_H5:!0})}),this.on_impression_callback&&this.on_impression_callback()}else console.log("Play Ads Error, show failed")}catch(e){console.log("Play Ads Error:"+e)}},e.prototype.stop=function(){},e.prototype.onLoaded=function(e){this.on_loaded_callback=e},e.prototype.onImpression=function(e){this.on_impression_callback=e},e.prototype.onComplete=function(e){this.on_complete_callback=e},e.prototype.onClose=function(e){this.on_close_callback=e},e.prototype.onSkip=function(e){this.on_skip_callback=e},e.prototype.onClick=function(e){this.on_click_callback=e},e}(),x=function(){function e(e){w=this,this.name=e.name,this.container_id=e.containerId,this.appKey=e.appKey,this.sign=e.sign,this.sdk=e.sdk,this.is_ad_cached=!1,this.is_play_finish=!1}return e.prototype.init=function(){this.is_ad_cached=!0,this.sdk.sendReport(3,{adsId:this.name})},e.prototype.onError=function(e){var t=w.sdk.events.error;t&&t({code:k,msg:"预加载广告时出错"}),console.log(e.getError())},e.prototype.isReady=function(){return this.is_ad_cached},e.prototype.showAdv=function(){if(!this.isReady)return!1;this.is_ad_cached=!1,this.is_play_finish=!1;try{var e=this.appKey;""!==this.sign&&(e=this.sign+"="+this.appKey),I("//i.hao61.net/d.js?"+e,"js",function(){});this.sdk.sendReport(5,{adsId:this.name,eventValue:JSON.stringify({Zmeng:!0})}),this.on_impression_callback&&this.on_impression_callback()}catch(e){console.log("Play Ads Error:"+e)}},e.prototype.stop=function(){},e.prototype.onLoaded=function(e){this.on_loaded_callback=e},e.prototype.onImpression=function(e){this.on_impression_callback=e},e.prototype.onComplete=function(e){this.on_complete_callback=e},e.prototype.onClose=function(e){this.on_close_callback=e},e.prototype.onSkip=function(e){this.on_skip_callback=e},e.prototype.onClick=function(e){this.on_click_callback=e},e}(),L=function(){function e(e){E=this,this.name=e.name,this.container_id=e.containerId,this.appKey=e.appKey,this.sdk=e.sdk,this.is_ad_cached=!1,this.is_play_finish=!1}return e.prototype.init=function(){this.is_ad_cached=!0,this.sdk.sendReport(3,{adsId:this.name})},e.prototype.onError=function(e){var t=E.sdk.events.error;t&&t({code:k,msg:"预加载广告时出错"}),console.log(e.getError())},e.prototype.isReady=function(){return this.is_ad_cached},e.prototype.showAdv=function(){if(!this.isReady)return!1;this.is_ad_cached=!1,this.is_play_finish=!1;try{I("//ad.i2000.xyz/ad?pid="+this.appKey,"js",function(){});this.sdk.sendReport(5,{adsId:this.name,eventValue:JSON.stringify({XinYi:!0})}),this.on_impression_callback&&this.on_impression_callback()}catch(e){console.log("Play Ads Error:"+e)}},e.prototype.stop=function(){},e.prototype.onLoaded=function(e){this.on_loaded_callback=e},e.prototype.onImpression=function(e){this.on_impression_callback=e},e.prototype.onComplete=function(e){this.on_complete_callback=e},e.prototype.onClose=function(e){this.on_close_callback=e},e.prototype.onSkip=function(e){this.on_skip_callback=e},e.prototype.onClick=function(e){this.on_click_callback=e},e}();o.d(t,"MobGi",function(){return R});var R=function(){function e(e){if(this.VERSION="1.0.0",this.adLoader={},this.serverInfo={},this.blockCacheConfig={},this.events={},this.timerUsed=!1,!e)throw"Missing required constructor arguments";this.storage=new d;var t=navigator,o=t.connection,n=void 0===o?{effectiveType:"other",type:"other"}:o,i=t.userAgent,a=screen.width,r=screen.height,s=b[(n.effectiveType||n.type).toUpperCase()],c=a+"*"+r,l=C[a>r?"LANDSCAPE":"PORTRAIT"],p=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),o="mobgi_js_sdk";t.textBaseline="top",t.font="14px 'Arial'",t.textBaseline="idreamsky",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText(o,2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText(o,4,17);var n=e.toDataURL().replace("data:image/png;base64,","");return function(e){var t,o,n,i="";for(t=0,o=(e+="").length;t<o;t++)i+=(n=e.charCodeAt(t).toString(16)).length<2?"0"+n:n;return i}(atob(n).slice(-16,-12))}();this.option=Object.assign({adType:1,blockId:"",channelId:"CURRENT00000",imei:"",androidId:"",idfa:"",uid:"",timeout:6,closeButtonPosition:"",debug:!1},e);var h=this.option,u=h.appVersion,f=h.appKey,g=h.adType,_=h.blockId,v=h.channelId,k=h.imei,I=h.androidId,A=h.idfa,w=h.uid;""!=w&&(p=w),""!=k?p=k:""!=A&&(p=A),h.debug&&(y={intergration:(m="//test.api.mobgi.com")+"/adx/v2/Intergration",report:m+"/adx/v1/web"});var E,T=this.storage.get("mobgi_old_user");T||this.storage.set("mobgi_old_user",!0),this.sdkInitTime=sessionStorage.getItem("mobgi_init_time"),this.sdkInitTime||(this.sdkInitTime=(new Date).getTime(),sessionStorage.setItem("mobgi_init_time",this.sdkInitTime)),this.config={device:{screenDirection:l,net:s,deviceId:p,platform:3,ip:"",operator:0,ua:i,resolution:c,androidId:I},providerId:1,adType:e.adType,app:{appKey:e.appKey},isTest:0,extra:{isNewUser:T?0:1},user:{id:p},gps:{lat:-1,lng:-1,timeStamp:0}},this.reportConfig={brand:-1,model:-1,appVersion:u,sdkVersion:this.VERSION,pointX:-1,pointY:-1,memoryValue:-1,cpuValue:-1,providerId:1,imei:p,imsi:-1,netType:s,operator:0,platform:3,adsId:-1,uuid:p,resolution:c,appKey:f,adType:g,blockId:_,eventSort:0,eventValue:0,usedTime:0,bidId:-1,userType:-1,configId:-1,cid:v,vh:1===l?2:1,sessionId:(E=sessionStorage.getItem("mobgi_sessionid"),E||(E="xxxx1xxx9xxx8xxxyxx8xxx7xxxx8xxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),sessionStorage.setItem("mobgi_sessionid",E)),E)},this.initialize()}return e.prototype.initialize=function(){this.getCache(),this.sendReport(15)},e.prototype.getCache=function(){var e=this.storage.get("mobgi_blockconfig");e&&(this.blockCacheConfig=e)},e.prototype.sendReport=function(e,t){var o=u(),i=(new Date).getTime(),a=this.serverInfo,r=a.bidId,d=void 0===r?-1:r,c=a.userType,l=void 0===c?-1:c,p=a.configId,h=void 0===p?-1:p,f=n({},this.reportConfig,{bidId:d,userType:l,configId:h,eventType:e,clientTime:parseInt((i/1e3).toString()),eventTime:i-this.sdkInitTime},t);console.log("数据上报,事件："+e),s(y.report+"?token="+o,f,{contentType:"application/json",header:{"content-type":"application/json"}})},e.prototype.parsingAvaliableBlock=function(){var e=this,t={};this.adLoader={},this.appBlockIdList&&this.appBlockIdList.map(function(o){var n=o.blockId,i=o.showLimit,a=o.rate;if(e.option.blockId==n){var r=Math.random();if(1!==a&&r>a)return e.sendReport(1705),void console.log("广告位["+o.blockIdName+"]概率随机未通过");0===i&&(i=1e10);var s={rate:+a,showLimit:i};e.blockCacheConfig[n]?e.blockCacheConfig[n].showLimit<i?t[n]=s:(e.sendReport(1704),console.log("广告位["+n+"]展示已到上限")):(e.blockCacheConfig[n]={showLimit:0},t[n]=s)}}),this.avaliableBlock=t,console.log("可用广告位 :",t),console.log("广告位展示次数缓存配置 :",this.blockCacheConfig)},e.prototype.parsingConfigPriority=function(){var e=this,t=Object.keys(this.avaliableBlock),o=this.thirdBlockList&&this.thirdBlockList.filter(function(e){return t.indexOf(e.blockId)>-1});if(o&&o.length>0){var n=o[0],i=n.generalConfigs,a=void 0===i?[]:i,r=n.prioritConfig,s=void 0===r?[]:r,d=n.blockId,c="priorit",l=s.sort(function(e,t){return e.index-t.index}).filter(function(t){t.levelType="priorit",0===t.showNumber&&(t.showNumber=1e10);var o=t.thirdPartyName+"_"+c,n=e.blockCacheConfig[d][o];if(n){if(n>=t.showNumber)return e.sendReport(1706),console.log("优先配置,["+t.thirdPartyName+"]展示次数已达上限"),!1}else e.blockCacheConfig[d][o]=0;return!0});if(0===l.length)c="general",l=a.filter(function(t){t.rate=+t.rate,t.levelType="general",0===t.showNumber&&(t.showNumber=1e10);var o=t.thirdPartyName+"_"+c,n=e.blockCacheConfig[d][o];if(n){if(n>=t.showNumber)return console.log("一般配置,["+t.thirdPartyName+"]展示次数已达上限"),!1}else e.blockCacheConfig[d][o]=0;return!0});else if(l.length<3){c="mixture";var p=a.filter(function(t){t.rate=+t.rate,t.levelType="general",0===t.showNumber&&(t.showNumber=1e10);var o=t.thirdPartyName+"_"+t.levelType,n=e.blockCacheConfig[d][o];if(n){if(n>=t.showNumber)return console.log("一般配置,["+t.thirdPartyName+"]展示次数已达上限"),!1}else e.blockCacheConfig[d][o]=0;return!0});if(p.length>0){p=p.sort(function(e,t){return t.rate-e.rate});for(var h=l.map(function(e){return e.thirdPartyName}),u=3-l.length,f=0;f<p.length&&(-1===h.indexOf(p[f].thirdPartyName)&&(l.push(p[f]),u--),0!==u);f++);}}return console.log("queue",l),this.queue=l,this.queueType=c,0===l.length?(this.events.error({code:v,msg:"没有符合条件配置"}),console.log("没有符合条件配置")):console.log("priorit"===c?"当前使用优先配置":"general"===c?"当前使用一般配置":"当前使用复合配置"),console.log("广告加载器配置 :",l),console.log("可用广告位配置 :",this.avaliableBlock),console.log("广告位展示次数缓存配置 :",this.blockCacheConfig),l.map(function(e){return e.thirdPartyName})}return[]},e.prototype.createAdapter=function(e){var t=this;this.thirdPartyAppInfo&&this.thirdPartyAppInfo.map(function(o){var n,i=t.option.containerId,a=o.thirdPartyAppkey,r=o.thirdPartyAppsecret,s=o.thirdPartyName;if(t.adLoader[s]||-1===e.indexOf(s))console.log("跳过初始化广告加载器————"+s);else{if(1===t.option.adType)if("Adsense"===s)n=new T({name:s,containerId:i,appKey:a,channel:r,sdk:t});else if("Mobvista_H5"===s){var d=t.queue.find(function(e){return e.thirdPartyName===s});n=new S({name:s,containerId:i,appKey:a,sdk:t,sign:r,unitId:d.thirdPartyBlockId,androidId:t.option.androidId,imei:t.option.imei,closeButtonPosition:t.option.closeButtonPosition})}else console.log("无可用广告加载器————"+s);else 7===t.option.adType&&("Zmeng"===s?n=new x({name:s,containerId:i,appKey:a,sign:r,sdk:t}):"XinYi"===s&&(n=new L({name:s,containerId:i,appKey:a,sdk:t})));if(n){console.log("初始化广告加载器————"+s);var c=t.events,l=c.impression,p=c.complete,h=c.close,u=c.skip,f=c.click;n.onImpression(function(){t.refreshCacheConfig(),l&&l()}),n.onComplete(function(){p&&p()}),n.onClose(function(){h&&h()}),n.onSkip(function(){u&&u()}),n.onClick(function(){f&&f()}),t.adLoader[s]=n}}}),console.log("初始化广告加载器完成")},e.prototype.loadedAdapters=function(){var e=[];for(var t in this.adLoader)this.adLoader.hasOwnProperty(t)&&this.adLoader[t].isReady()&&e.push(t);return e},e.prototype.refreshCacheConfig=function(){console.log("更新缓存配置");var e=this.option.blockId;this.blockCacheConfig[e][this.cacheConfigKey]++,this.blockCacheConfig[e].showLimit++,this.storage.set("mobgi_blockconfig",this.blockCacheConfig,{expires:(new Date).setHours(23,59,59,999)})},e.prototype.addEventListener=function(e,t){this.events[e]=t},e.prototype.getConfig=function(){return i(this,void 0,void 0,function(){var e,t,o,n,i,r,d,c,l,p,h,f=this;return a(this,function(a){switch(a.label){case 0:e=u(),t=!1,console.dir(this.config),this.sendReport(1),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,s(y.intergration+"?token="+e,this.config,{contentType:"application/json",header:{"content-type":"application/json"}}).then(function(e){var o=e;if(0===o.ret){t=!0,f.sendReport(2),console.log("获取配置成功",e);var n=o.data,i=n.thirdPartyAppInfo,a=n.thirdBlockList,r=n.appBlockIdList,s=n.serverInfo;f.thirdPartyAppInfo=i,f.thirdBlockList=a,f.appBlockIdList=r,f.serverInfo=s;var d=f.option,c=d.appKey,l=d.adType;f.storage.set("mobgi_config_"+c+"_"+l,o.data)}else console.log("获取配置失败",e),f.events.error&&f.events.error({code:_,msg:"获取配置失败"})})];case 2:return a.sent(),[3,4];case 3:return a.sent(),o=this.option,n=o.appKey,i=o.adType,(r=this.storage.get("mobgi_config_"+n+"_"+i))&&(t=!0,d=r.thirdPartyAppInfo,c=r.thirdBlockList,l=r.appBlockIdList,p=r.serverInfo,this.thirdPartyAppInfo=d,this.thirdBlockList=c,this.appBlockIdList=l,this.serverInfo=p),[3,4];case 4:return!1===t?(this.events.error&&this.events.error({code:_,msg:"获取配置失败"}),[2]):(this.parsingAvaliableBlock(),h=this.parsingConfigPriority(),this.createAdapter(h),[2])}})})},e.prototype.init=function(){return i(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.getConfig()];case 1:return e.sent(),this.preLoad(),[2]}})})},e.prototype.checkIsReady=function(e){var t=this;if(!1===this.timerUsed){this.timerUsed=!0;var o=0,n=2*this.option.timeout,i=setInterval(function(){++o,t.isReady(!1)?(t.timerUsed=!1,clearInterval(i),t.sendReport(1700),e(!0)):o>n&&(t.timerUsed=!1,clearInterval(i),t.sendReport(1702),e(!1))},500)}},e.prototype.isReady=function(e){return void 0===e&&(e=!0),this.loadedAdapters().length>0?(e&&this.sendReport(1700),!0):(e&&this.sendReport(1702),!1)},e.prototype.preLoad=function(e){for(var t in void 0===e&&(e=!0),this.parsingConfigPriority(),this.adLoader)this.adLoader.hasOwnProperty(t)&&!1===this.adLoader[t].isReady()&&this.adLoader[t].init();console.log("this.adLoader",this.adLoader),e&&this.events.hasOwnProperty("loaded")&&this.checkIsReady(this.events.loaded)},e.prototype.showAds=function(){var e=this.loadedAdapters(),t={};if(0!==e.length){if("priorit"===this.queueType){console.log("使用优先配置");for(var o=0;o<this.queue.length;o++){var n=this.queue[o].thirdPartyName;if(e.indexOf(n)>-1){this.cacheConfigKey=n+"_"+this.queueType,this.adLoader[n].showAdv(),t[n]=!0;break}}}else if("general"===this.queueType){console.log("使用一般配置");var i=f(s=this.queue.filter(function(t){return e.indexOf(t.thirdPartyName)>-1}),"rate");for(o=0;o<s.length;o++){n=s[o].thirdPartyName;if(i.thirdPartyName===n){this.cacheConfigKey=n+"_"+this.queueType,this.adLoader[n].showAdv(),t[n]=!0;break}}}else{console.log("使用复合配置，先优先，后一般");var a=!1,r=this.queue.filter(function(e){return"priorit"===e.levelType});for(o=0;o<r.length;o++){n=r[o].thirdPartyName;if(e.indexOf(n)>-1){this.cacheConfigKey=n+"_"+r[o].levelType,this.adLoader[n].showAdv(),t[n]=!0,a=!0;break}}if(!1===a){var s;for(i=f(s=this.queue.filter(function(e){return"general"===e.levelType}).filter(function(t){return e.indexOf(t.thirdPartyName)>-1}),"rate"),o=0;o<s.length;o++){n=s[o].thirdPartyName;if(i.thirdPartyName===n){this.cacheConfigKey=n+"_"+s[o].levelType,this.adLoader[n].showAdv(),t[n]=!0;break}}}}for(var d in this.adLoader)this.adLoader.hasOwnProperty(d)&&!1===this.adLoader[d].isReady()&&(t[d]=!1);this.sendReport(14,{eventValue:JSON.stringify(t)})}else console.log("没有准备好的广告加载器")},e}()}])});
//# sourceMappingURL=mobgi_jssdk_1.0.0.js.map